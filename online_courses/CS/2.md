### 1. 이중모드, 하드웨어 보호

- 이중모드 : 한 컴퓨터를 여러 사람이 동시에 사용하는 환경, 또는 한 사람이 여러 개의 프로그램을 동시에 사용. 한 사람의 고의/실수 프로그램이 전체 영향
  - CPU안에 register : 이 안에 CPU상태를 나타내는 bit가 있다. 레지스터에 모드를 나태는 flag가 있음. flag안에 이중모드를 나타내는 bit를 하나를 추가한다. 
  - Power on -> booting -> os가 하드디스크에서 메인 메모리로. 모니터 비트가 전부 1, 시스템 모드 -> 부팅 끝 -> 사용자 프로그램 메인 메모리로. user 모드
  - 하드웨어, 소프트웨어 인터럽트 발생하면 시스템 모드
  - 운영체제 서비스 끝나면 다시 user 모드

- 사용자 프로그램은 STOP 등 치명적 명령 사용 불가하게!
  - 사용자 모드 vs 관리자 모드 => 이중 모드
  - 관리자 모드(supervisor) = 시스템 모드 = 모니터 모드 = 특권 모드(privileged)
- 특권 명령 : STOP, HALT, RESET, SET, TIMER, SET_HW 등등



- 하드웨어 보호 : 입출력장치 보호, 메모리 보호, CPU 보호
  - 입출력장치 보호 : 사용자의 잘못된 입출력 명령(다른 사용자에게 방해). 입출력 명령을 특권 명령으로. 
    - ex) 게임은 user모드인데 출력을 명령하면 OUT을 특권 명령으로 지정했기 때문에 바로 CPU는 내부 인터럽트 루틴에서 판별 -> 프로그램 강제 종료. 게임이 직접 명령을 내리지 않고 부탁을 해야함(software interrupt). 
    - 그래서 A의 디스크에 있는 파일을 B가 보려고 부탁한다면? 소프트웨어 인터럽트 발생시키면서 접근은 할 수 있지만 OS가 거부. 확인하는 루틴도 내장되어 있음. privileged instruction violation
- 메모리 보호 : 다른 사용자 메모리 또는 운영체제 영역 메모리 접근
  - cpu가 메모리로 address bus가 가는데 다른 영역에 못가도록 잘라버림(?). 그런데 자르면 자기 영역에도 못감. 해결책이 아님.
  - address 버튼에 문지기를 만든다. 주소가 해당 user의 영역이 아닌 곳으로 가려한다면 막아버림. 문지기는 base부터 limit사이에 오는 건 통과시키는 식으로 만든다. MMU(memory management unit). MMU 설정은 특권 명령.
  - segment violation