### 1. 교착상태 Deadlocks (저번 파일에 이어서)

- 처리 : 방지, 회피, 검출 및 복구, 무시
  - 방지(Prevention) : 교착상태 네가지 필요조건 중 한 가지 이상 불만족
    - 상호배타 : 자원을 공유하도록 한다. 일반적으로 불가능하다. 
    - 보유 및 대기 : 철학자 문제에서 젓가락 하나 가진 상태에서 하나를 기다리지 않고 두 개를 동시에 들게해야한다. 굶어죽게 될 수도 있다. 
    - 비선점 : 자원 선점 가능.강제로 뺏어오기. 일반적으로 불가능하다.
    - 환형대기 : 번호를 부여해 오름차순으로 지원 요청하거나 짝수, 홀수를 나눠서 순서를 다르게 한다. 자원의 활용률이 저하된다.
    - 그나마 보유 및 대기, 환형대기가 현실적으로 사용할 수 있다.
  - 회피(Avoidance) : 교착상태는 자원 요청에 대한 잘못된 승인이다. 은행에서 대출을 잘못된 사람한테 해주는 것처럼. 안전한 할당(safe allocation)필요 Banker's Algorithm
    - 예시 : 프로세스 3개가 각각 필요한 양만큼 할당한다. 하지만 각 프로세스가 각각 필요한 양을 전부 채우기 위해서 더 요구한다. 하지만 현재 남은 양보다 크게 요구하는 프로세스는 건너뛰고 줄 수 있는 만큼 요구하는 프로세스에게 주고, 필요한 양을 전부 받은 프로세스는 작업을 끝내고 받았던 양을 전부 반환한다. 이 경우는 잘 할당받지만
    - 예시2 : 두 번째 요구할 때 프로세스들이 현재 있는 양보다 많이 요구하면 무한 대기 상태에 들어간다.(Deadlocks)
  - 검출 및 복구(Detection & Recovery) : 교착상태 일어나는 걸 허용. 주기적 검사(자주하면 빨리 발견하지만 cpu,메모리가 소요됨. 오버헤드), 교착상태 발생하면 복구(일부 강제종료, 자원 선점(강제로 뺏기)해 일부 프로세스에게 할당)
  - 무시(Don't Care) : 어차피 교착상태는 잘 안일어난다. 



### 2.  모니터  M onitors

- 사실 세마포는 좀 오래된 동기화도구. 요즘 자바에선 모니터를 많이 사용한다.
- 세마포 이후  프로세스 동기화 도구로 세마포보다 고수준 개념이다.
- 구조 : 공유자원 + 공유자원 접근 함수. 한 쓰레드가 공유자원 접근함수에 진입했으면 다른 쓰레드는 접근 못 하고 배타동기에서 기다린다. 2개의 queue존재. 배타동기(mutual exclusion), 조건동기(conditional sync).  들어온 쓰레드가 wake()를 부르면 조건동기로 블록되는데 그럼 함수가 비어있어 새로운 스레드가 진입할 수 있다. 새 쓰레드는 조건동기에 있는 함수를 notify()를 통해 깨운다. 깬 이후 조건동기에 있는 쓰레드가 나가면 진입할 수 있다.
- 자바 모니터 : 모든 객체가 모니터가 될 수 있다. 배타동기 sychronized 키워드를 사용해 지정하고 조건동기는 wait(), notify(), notifyAll() 메소드를 사용한다.
- 세마포는 acquire(), release()를 꼭 사용하고 초기값을 변화시켜 mutual exclusion을 구현했는데 모니터는 synchronized만 붙이면 되니까 편리하다.
- 또 세마포에서 반드시 p1이 먼저 실행되게 하려면 또 초기값을 설정해서 특정 조건에서는 p1이 무조건 들어가야한다. 이런식으로 설정해야했는데 모니터에선 자기 차례 아니면 wait(). 그리고 원래 프로세스가 나가서 잠들면 진입했다가 notify()로 깨워줌 