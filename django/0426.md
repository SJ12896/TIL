## REST API

### 1. API

- API(Application Programming Interface) : 프로그래밍 언어가 제공하는 기능을 수행할 수 있게 만든 인터페이스 (어플리케이션과 프로그래밍으로 소통하는 방법). CLI, GUI는 각각 명령줄과 그래픽(아이콘)을 통해서 특정 기능 수행. API는 프로그래밍을 통해 그 일을 수행
- Web API : 웹 어플리케이션 개발에서 다른 서비스에 `요청`을 보내고 `응답`을 받기 위해 정의된 명세. 현재 웹개발은 추가로 모든 것을 개발하지 않고 Open API를 가져와서 활용하는 추세. (구글, 카카오지도 API, 도로명 API 등)
- API Server : Client가 요청을 보내면 Server에서 응답(비디오, 문서, 이미지, 애플리케이션 등) / JSON형태의 파일을 받는 연습할 예정

<br/>

### 2. REST API

- REpresentational State Transfer : 표현에 대한 상태 정의?
- 웹 설계 상의 장점을 최대한 활용할 수 있는 아키텍처 방법론
- 네트워크 아키텍쳐 원리의 모음 -> 자원resource(data의미)을 정의, 자원에 대한 주소 지정 방법
- REST 원리를 따르는 시스템 혹은 API를 RESTful API라고 하기도 함.
- `자원`과 `주소`를 지정하는 방법
- REST 구성 : 자원URI, 행위HTTP Method, 표현Representations

<br/>

### 3. URI

- 보여주고 싶은 정보 / 보고싶은 정보가 어디에 있는지

- Uniform Resource Identifier

- 통합 자원 식별자

- 인터넷의 자원을 나타내는 유일한 주소

- 인터넷 자원을 식별하거나 이름을 지정하는데 사용되는 간단한 문자열

- 하위 개념 URL URN

- URN을 사용하는 비중이 매우 적기 때문에 일반적으로 URL은 URI를 통칭하는 말로 사용하기도 함

  

- URL : Uniform Resource Locator, 통합 자원 위치. 네트워크 상 자원(리소스)이 어디 있는지(주소)를 알려주기 위한 약속. 자원은 HTML 페이지, CSS 문서, 이미지 등이 될 수 있다. '웹 주소' 또는 '링크'라고 불림

- URN : Uniform Resource Name, 통합 자원 이름. URL과 달리 자원 위치에 영향을 받지 않는 유일한 이름 역할(독립적 이름), 자원의 이름이 변하지 않는 한 자원의 위치를 이곳저곳 옮겨도 문제없이 동작. ex) ISBN

- URN은 자원의 ID를 정의하고, URL은 자원을 찾는 방법 제공. 상호 보완적이다.

- URI구조 : Scheme / Protocol / Host / Port / Path / <= 여기까지 URL로보고 뒤에 Query(Get방식) / Fragment(# 태그) <= URI에 속하는 개념

  - ex) http://localhost:3000/posts/3

- URI 설계 주의사항 : 밑줄이 아닌 `하이픈` 사용. (URI의 가독성을 위해), `소문자` 사용(대소문자에 따라 다른 자원으로 인식하게 됨), `파일 확장자는 포함시키지 않음`

<br/>

### 4.  HTTP(HyperText Transfer Protocol) Method

- 자원에 대한 행위. HTTP는 HTTP Method를 정의해 주어진 자원에 수행하길 원하는 행동을 나타냄. 의미론적으로 행위를 규정하기 때문에 실제 그 행위 자체가 수행됨을 보장하진 않음. HTTP verbs라고도 함. 
- GET : 특정 자원 표시를 요청하며, 오직 데이터를 받기만 함
- POST : 서버로 데이터를 전송하며 서버에 변경사항을 만듦
- PUT : 요청한 주소의 자원 수정
- DELETE : 지정한 자원을 삭제

<br/>

### 5. Representation

- JSON : JavaScript Object Notation / lightweight data-interchange format / 자바스크립트 객체 문법을 따르며, 구조화된 데이터를 표현하기 위한 문자 기반 데이터 포맷. 일반적으로 웹 어플리케이션에서 클라이언트로 데이터를 전송할 때 사용. 자바스크립트 구문에 기반을 두고 있지만 차이점 있으니 주의
- 특징 : 사람이 읽고 쓰기 쉽고 기계가 파싱(해석 & 분석)하고 만들어내기 쉽다. 파이썬의 딕셔너리, 자바스크립트 오브젝트 처럼 C계열 언어가 갖고 있는 자료구조로 쉽게 변환할 수 있는 key-value구조로 되어 있음. 

<br/>

### 6. Django REST Framework

- Web API 구축을 위한 강력한 toolkit 제공. REST framework 개발에 필요한 다양한 기능을 제공

- Serialization(직렬화) : 데이터 구조나 객체 상태를 동일하거나 다른 컴퓨터 환경에 저장하고 나중에 재구성할 수 있는 포맷으로 변환하는 과정 (중간 변환기)
- DRF의 Serializer : django의 queryset 및 model instance와 같은 복잡한 데이터를 JSON, XML 등의 유형으로 쉽게 변환할 수 있는 python 데이터 타입으로 만들어 줌.  django form및 modelform 클래스와 매우 유사하게 작동
- django response : html / drf response : json
- django model : modelform / drf model : model serializer

<br/>

### 7. 실습

- [dummy data 라이브러리 : dajngo-seed](https://github.com/Brobin/django-seed) : 원하는 갯수만큼 dummy data를 만들어준다. 
- urls.py

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/', include('articles.urls')),
]
```

- articles/urls.py

```python
from django.urls import path
from . import views


urlpatterns = [
    path('html/', views.article_html),
    path('json-1', views.article_json_1),
    path('json-2', views.article_json_2),
    path('json-3', views.article_json_3),
]
```

- articles/views.py
- 3번 방법을 사용한다. 1, 2번 방법은 3

```python
from rest_framework.response import Response
from rest_framework.decorators import api_view

from django.shortcuts import render
from django.http.response import JsonResponse, HttpResponse
from django.core import serializers
from .models import Article
from .serializers import ArticleSerializer

# 평소에 하던 html 페이지를 보여주는 방식이다.
def article_html(request):
    articles = Article.objects.all()
    context = {
        'articles' : articles,
    }
    return render(request, 'articles/article.html', context)


def article_json_1(request):
    articles = Article.objects.all()
    articles_json = []

    for article in articles:
        articles_json.append(
            {
                'id' : article.pk,
                'content' : article.content,
            }
        )
    # dictionary가 아닌 다른 타입이 json으로 바뀌는 상황이라(articles_json은 리스트) safe옵션 False로 
    return JsonResponse(articles_json, safe=False)


def article_json_2(request):
    articles = Article.objects.all()
    # json형태로 serialize한다. articles를
    data = serializers.serialize('json', articles)
    # 이미 json이라 jsonresponse말고 httpresponse, http 통신간의 content type 지정 필요
    return HttpResponse(data, content_type='application/json')


# django rest framework를 사용했다. 자세한 내용은 아래서
# require decorator를 사용할 때 처럼 저 데코레이터를 꼭 사용해야한다.
@api_view(['GET'])
def article_json_3(request):
    articles = Article.objects.all()
    # 단일 객체냐 아니냐 many로 표현. 기본 값이 False
    serializer = ArticleSerializer(articles, many=True)
    return Response(serializer.data)
```



- [django rest framework](https://www.django-rest-framework.org/)

- serializers.py 파일을 만든다. forms.py와 마찬가지로 다른 이름으로 만들어도 되지만 알아보기 쉽게 저 이름으로 만들었다.
- rest framework를 설치하고 적용한다.

```python
from rest_framework import serializers
from .models import Article


class ArticleSerializer(serializers.ModelSerializer):

    class Meta:
        model = Article
        fields = '__all__'
```



